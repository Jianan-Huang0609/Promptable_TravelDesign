<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Promptable TravelDesign Â· Prompt ç”Ÿæˆå™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#0b1220; --muted:#5a6a84; --line:#dde5f1; --card:#fff;
    --blue:#1976ff; --green:#0fb9b1; --coral:#ff7f6a;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#f8faff;color:var(--ink);
    font-family:"Noto Sans SC","Inter","PingFang SC","Hiragino Sans GB","Microsoft YaHei","WenQuanYi Micro Hei",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  h1{margin:8px 0 6px;font-size:28px;color:#0b1220;letter-spacing:.2px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:10px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 8px 24px rgba(25,118,255,.06)}
  label{display:block;margin-top:10px;font-weight:700}
  input,textarea,select{
    width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;
    margin-top:8px;font-size:14px;background:#fff
  }
  textarea{min-height:84px;resize:vertical}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn{border:1px solid var(--line);background:#fff;color:#2b3d55;
    padding:8px 12px;border-radius:999px;font-size:14px;cursor:pointer;user-select:none}
  .btn:hover{border-color:#c8d6ea}
  .btn.active{border-color:transparent;background:linear-gradient(90deg, var(--green), #67dfd9);color:#003c39;box-shadow:0 6px 18px rgba(15,185,177,.28)}
  .btn.blue.active{background:linear-gradient(90deg, var(--blue), #5aa3ff);color:#fff}
  .btn.coral.active{background:linear-gradient(90deg, var(--coral), #ffb19f);color:#5b1a0f}
  .grid{display:grid;gap:14px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  @media (max-width:900px){.grid.cols-2{grid-template-columns:1fr}}
  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .primary{background:linear-gradient(90deg, var(--blue), #5aa3ff);color:#fff;border:none}
  .primary:hover{filter:brightness(.98)}
  .ghost{background:#fff;border:1px dashed var(--line)}
  .warn{background:#fff6f5;border:1px solid #ffd5cf}
  #output{white-space:pre-wrap;background:#0b1220;color:#e6eefc;padding:14px;border-radius:10px;
    margin-top:12px;border:1px solid #1d2a3f;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
  .hint{font-size:12px;color:var(--muted)}
  .section-title{font-weight:800;margin:0 0 8px 0}
  .divider{height:1px;background:linear-gradient(90deg,rgba(25,118,255,.0),rgba(25,118,255,.2),rgba(25,118,255,.0));margin:12px 0}
  .link{color:#1976ff;text-decoration:none}

  /* CTA styles for example link */
  .cta{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;
       background:linear-gradient(90deg, var(--blue), #5aa3ff); color:#fff !important; text-decoration:none;
       box-shadow:0 6px 18px rgba(25,118,255,.26); font-weight:700}
  .cta:hover{filter:brightness(.98)}

</style>
</head>
<body>
<div class="wrap">
  <h1>Promptable TravelDesign Â· Prompt ç”Ÿæˆå™¨</h1>
  <div class="sub">æŒ‰é’®åŒ–é€‰æ‹© + æ‰‹æ‰“è¡¥å…… â†’ ä¸€é”®å¯¼å‡º Promptï¼ˆTXT/MDï¼‰ã€‚
    <a class="link" href="https://jianan-huang0609.github.io/Promptable_TravelDesign/SINGAPORE_v4.html" target="_blank">æ¡ˆä¾‹-æ–°åŠ å¡æ”»ç•¥ â†—</a>
  </div>

  <div class="toolbar">
    <a class="cta" href="https://jianan-huang0609.github.io/Promptable_TravelDesign/SINGAPORE_v4.html" target="_blank" rel="noopener">ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ”»ç•¥_ä¾‹å­</a>
    <button class="btn ghost" id="example">ä¸€é”®ç¤ºä¾‹ï¼šæ–°åŠ å¡ 4D3N</button>
    <button class="btn warn" id="clearAll">æ¸…ç©ºæ‰€æœ‰ + æ¸…é™¤ç¼“å­˜</button>
    <button class="btn" id="reset">é‡ç½®ä¸ºé»˜è®¤</button>
    <button class="btn" id="reload">é¡µé¢é‡è½½</button>
  </div>

  <div class="panel">
    <div class="section-title">åŸºæœ¬ä¿¡æ¯</div>
    <div class="grid cols-2">
      <div>
        <label>æ—…è¡Œå¼€å§‹æ—¥æœŸ</label>
        <div class="row">
          <select id="startYear"></select>
          <select id="startMonth"></select>
          <select id="startDay"></select>
        </div>
      </div>
      <div>
        <label>æ—…è¡Œç»“æŸæ—¥æœŸ</label>
        <div class="row">
          <select id="endYear"></select>
          <select id="endMonth"></select>
          <select id="endDay"></select>
        </div>
      </div>
      <div>
        <label>ç›®çš„åœ°</label>
        <input id="location" placeholder="ä¾‹å¦‚ï¼šæ–°åŠ å¡ + é™„è¿‘æµ·å²›ï¼ˆæ°‘ä¸¹/å·´æ·¡ï¼‰">
      </div>
      <div>
        <label>é¢„ç®—èŒƒå›´</label>
        <input id="budget" placeholder="ä¾‹å¦‚ï¼šÂ¥5000-8000/äºº">
      </div>
      <div>
        <label>å¤–éƒ¨å‚è€ƒé“¾æ¥ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
        <textarea id="links" placeholder="https://..."></textarea>
      </div>
      <div>
        <label>å‚è€ƒé“¾æ¥ç®€è¿°ï¼ˆå¯é€‰ï¼Œå¯¹åº”é¡ºåºï¼‰</label>
        <textarea id="linkDesc" placeholder="ç¾é£Ÿæ‰“å¡\nåœ£æ·˜æ²™äº²å­\nåŸå¸‚æ‹ç…§ç‚¹"></textarea>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-title">åå¥½æ ‡ç­¾ï¼ˆç‚¹æŒ‰é’®å¯å¤šé€‰ï¼‰</div>
    <div id="tags" class="row">
      <button class="btn" data-multi data-value="ç¾é£Ÿä¼˜å…ˆ">ç¾é£Ÿä¼˜å…ˆ</button>
      <button class="btn" data-multi data-value="å‡ºç‰‡ä¼˜å…ˆ">å‡ºç‰‡ä¼˜å…ˆ</button>
      <button class="btn" data-multi data-value="ä¸èµ¶è¡Œç¨‹">ä¸èµ¶è¡Œç¨‹</button>
      <button class="btn" data-multi data-value="æµ·å²›">æµ·å²›</button>
      <button class="btn" data-multi data-value="å¤œæ™¯">å¤œæ™¯</button>
      <button class="btn" data-multi data-value="è´­ç‰©">è´­ç‰©</button>
      <button class="btn" data-multi data-value="äº²å­">äº²å­</button>
    </div>

    <label style="margin-top:14px">æ‰‹æ‰“è¡¥å……è¦æ±‚ï¼ˆä¼šåŸæ ·æ’å…¥ Promptï¼‰</label>
    <textarea id="manual" placeholder="- å‘¨å…­å®‰æ’åœ£æ·˜æ²™æ•´å¤©\n- æ¯å¤©åŠ  2 å®¶æ²¿çº¿å£ç¢‘é¤å…\n- è¡Œç¨‹å¡ç‰‡æ¨ªå‘æ»‘åŠ¨ + æ—¶é—´çº¿\n- ä¸ç”¨å›¾ç‰‡ï¼Œæ”¹ä¸ºè¦ç‚¹ bullet"></textarea>
  </div>

  <div class="panel">
    <div class="section-title">é£æ ¼ä¸å¤–è§‚</div>
    <div class="row">
      <div>
        <div class="hint">ç½‘ç«™ä¸»é¢˜ï¼ˆå•é€‰ï¼‰</div>
        <div id="theme" class="row">
          <button class="btn blue" data-single data-group="theme" data-value="Bento-Tech">Bento-Techï¼ˆè“ç™½ï¼‰</button>
          <button class="btn active" data-single data-group="theme" data-value="Tropical">Tropicalï¼ˆæµ·å²›ï¼‰</button>
          <button class="btn coral" data-single data-group="theme" data-value="Sunset">Sunsetï¼ˆæ—¥è½æ©™ï¼‰</button>
          <button class="btn" data-single data-group="theme" data-value="Minimal">Minimalï¼ˆæç®€ï¼‰</button>
        </div>
      </div>
      <div>
        <div class="hint">èƒŒæ™¯é£æ ¼ï¼ˆå•é€‰ï¼‰</div>
        <div id="bg" class="row">
          <button class="btn active" data-single data-group="bg" data-value="Gradient">æ¸å˜èƒŒæ™¯</button>
          <button class="btn" data-single data-group="bg" data-value="Texture">ç»†è…»çº¹ç†</button>
          <button class="btn" data-single data-group="bg" data-value="Plain">çº¯ç™½</button>
        </div>
      </div>
      <div>
        <div class="hint">Emoji å¼ºåº¦</div>
        <div id="emoji" class="row">
          <button class="btn" data-single data-group="emoji" data-value="å°‘é‡">å°‘é‡</button>
          <button class="btn active" data-single data-group="emoji" data-value="é€‚ä¸­">é€‚ä¸­</button>
          <button class="btn" data-single data-group="emoji" data-value="åå¤š">åå¤š</button>
        </div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="section-title">ç”Ÿæˆ & å¯¼å‡º</div>
    <div class="actions">
      <button class="btn primary" id="gen">ç”Ÿæˆ Prompt</button>
      <button class="btn" id="copy">å¤åˆ¶</button>
      <button class="btn" id="exportTxt">å¯¼å‡º .txt</button>
      <button class="btn" id="exportMd">å¯¼å‡º .md</button>
      <button class="btn" id="exportHtml">å¯¼å‡º HTMLï¼ˆå•é¡µï¼‰</button>
      <button class="btn warn" id="resetForm">é‡ç½®å¡«å†™</button>
      <span class="hint">å°†ç”Ÿæˆçš„ Prompt ç²˜è´´åˆ° ChatGPT / Cursorã€‚å†…å®¹ä¼šè‡ªåŠ¨ä¿å­˜ã€‚</span>
    </div>
    <div id="output"></div>
  </div>

  <div class="panel">
    <div class="section-title">ç¤ºä¾‹å…¥å£</div>
    <div class="row">
      <a class="link" href="https://jianan-huang0609.github.io/Promptable_TravelDesign/SINGAPORE_v4.html" target="_blank">æ¡ˆä¾‹-æ–°åŠ å¡æ”»ç•¥ â†—</a>
    </div>
  </div>
</div>

<script>
// ----- date dropdowns -----
const yRange = [2025, 2028];
function fillYears(sel){ for(let y=yRange[0]; y<=yRange[1]; y++){ const o=document.createElement('option'); o.value=o.textContent=y; sel.appendChild(o);} }
function fillMonths(sel){ for(let m=1; m<=12; m++){ const o=document.createElement('option'); o.value=o.textContent=String(m).padStart(2,'0'); sel.appendChild(o);} }
function daysInMonth(y,m){ return new Date(y, m, 0).getDate(); }
function fillDays(sel, y, m){ sel.innerHTML=''; const n=daysInMonth(y, m); for(let d=1; d<=n; d++){ const o=document.createElement('option'); o.value=o.textContent=String(d).padStart(2,'0'); sel.appendChild(o);} }

function setupDate(idY,idM,idD, defY,defM,defD){
  const y=document.getElementById(idY), m=document.getElementById(idM), d=document.getElementById(idD);
  fillYears(y); fillMonths(m);
  y.value=defY; m.value=String(defM).padStart(2,'0'); fillDays(d, defY, defM); d.value=String(defD).padStart(2,'0');
  y.addEventListener('change', ()=>{ fillDays(d, Number(y.value), Number(m.value)); saveState(); });
  m.addEventListener('change', ()=>{ fillDays(d, Number(y.value), Number(m.value)); saveState(); });
  d.addEventListener('change', saveState);
}

// ----- buttons -----
function getMultiValues(containerId){
  return Array.from(document.querySelectorAll('#'+containerId+' .btn.active[data-multi]')).map(b=>b.dataset.value);
}
function getSingleValue(group){
  const btn = document.querySelector('.btn.active[data-group="'+group+'"]');
  return btn ? btn.dataset.value : "";
}
function toggleBtn(e){
  const b = e.target.closest('.btn'); if(!b) return;
  if(b.id==='gen'||b.id==='copy'||b.id==='exportTxt'||b.id==='exportMd'||b.id==='example'||b.id==='clearAll'||b.id==='reset'||b.id==='reload') return;
  if(b.hasAttribute('data-multi')) b.classList.toggle('active');
  if(b.hasAttribute('data-single')){
    const group = b.dataset.group;
    document.querySelectorAll('.btn[data-group="'+group+'"]').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
  }
  saveState();
}
document.addEventListener('click', toggleBtn);

// ----- state -----
function currentDateRangeStr(){
  const sY=startYear.value,sM=startMonth.value,sD=startDay.value;
  const eY=endYear.value,eM=endMonth.value,eD=endDay.value;
  return `${sY}-${sM}-${sD} è‡³ ${eY}-${eM}-${eD}`;
}
function saveState(){
  const state = {
    startYear:startYear.value, startMonth:startMonth.value, startDay:startDay.value,
    endYear:endYear.value, endMonth:endMonth.value, endDay:endDay.value,
    location: document.getElementById('location').value,
    budget: document.getElementById('budget').value,
    links: document.getElementById('links').value,
    linkDesc: document.getElementById('linkDesc').value,
    manual: document.getElementById('manual').value,
    tags: getMultiValues('tags'),
    theme: getSingleValue('theme'),
    bg: getSingleValue('bg'),
    emoji: getSingleValue('emoji'),
  };
  localStorage.setItem('ptd_state', JSON.stringify(state));
}
function loadState(){
  const raw = localStorage.getItem('ptd_state');
  if(!raw) return;
  try{
    const s = JSON.parse(raw);
    startYear.value = s.startYear || startYear.value;
    startMonth.value = s.startMonth || startMonth.value;
    fillDays(startDay, Number(startYear.value), Number(startMonth.value));
    startDay.value = s.startDay || startDay.value;

    endYear.value = s.endYear || endYear.value;
    endMonth.value = s.endMonth || endMonth.value;
    fillDays(endDay, Number(endYear.value), Number(endMonth.value));
    endDay.value = s.endDay || endDay.value;

    document.getElementById('location').value = s.location||"";
    document.getElementById('budget').value = s.budget||"";
    document.getElementById('links').value = s.links||"";
    document.getElementById('linkDesc').value = s.linkDesc||"";
    document.getElementById('manual').value = s.manual||"";
    (s.tags||[]).forEach(v=>{
      const el = Array.from(document.querySelectorAll('#tags .btn[data-multi]')).find(b=>b.dataset.value===v);
      if(el) el.classList.add('active');
    });
    ['theme','bg','emoji'].forEach(group=>{
      const val = s[group]; if(!val) return;
      const el = Array.from(document.querySelectorAll('.btn[data-group="'+group+'"]')).find(b=>b.dataset.value===val);
      if(el){ document.querySelectorAll('.btn[data-group="'+group+'"]').forEach(x=>x.classList.remove('active')); el.classList.add('active'); }
    });
  }catch(e){console.warn(e)}
}

// ----- prompt -----
function styleSpec(theme, emoji){
  if(theme==='Tropical') return `é£æ ¼ï¼šTropical æµ·å²›é£ï¼ˆæµ·å²›é’ç»¿+çŠç‘šæ©™ï¼‰ï¼Œç»†è…»çº¹ç†æˆ–æ¸å˜èƒŒæ™¯ï¼›emoji ä½¿ç”¨é‡ï¼š${emoji}ï¼›`;
  if(theme==='Sunset') return `é£æ ¼ï¼šSunset æ—¥è½æ©™ï¼ˆæš–æ©™æ¸å˜ï¼‰ï¼Œå¤§å·æ ‡é¢˜ï¼ŒæŸ”å’ŒæŠ•å½±ï¼›emoji ä½¿ç”¨é‡ï¼š${emoji}ï¼›`;
  if(theme==='Minimal') return `é£æ ¼ï¼šMinimal æç®€ï¼ˆé»‘ç™½ç° + å°‘é‡ç‚¹ç¼€è‰²ï¼‰ï¼Œç•™ç™½å¤šï¼›emoji ä½¿ç”¨é‡ï¼š${emoji}ï¼›`;
  return `é£æ ¼ï¼šBento-Tech è“ç™½ç§‘æŠ€æ„Ÿï¼ˆBento å¡ç‰‡ + Motion One åŠ¨æ•ˆï¼‰ï¼›emoji ä½¿ç”¨é‡ï¼š${emoji}ï¼›`;
}
function generatePrompt(){
  const date = currentDateRangeStr();
  const location = document.getElementById('location').value.trim();
  const budget = document.getElementById('budget').value.trim();
  const tags = getMultiValues('tags').join(' / ');
  const links = document.getElementById('links').value.trim().split('\n').filter(Boolean);
  const linkDesc = document.getElementById('linkDesc').value.trim().split('\n').filter(Boolean);
  const manual = document.getElementById('manual').value.trim();
  const theme = getSingleValue('theme') || 'Tropical';
  const bg = getSingleValue('bg') || 'Gradient';
  const emoji = getSingleValue('emoji') || 'é€‚ä¸­';
  const linkText = links.map((l,i)=>`[é“¾æ¥${i+1}] ${linkDesc[i]||''} ${l}`).join('\n');

  const prompt = `æˆ‘å°†è¿›è¡Œä¸€æ¬¡æ—…è¡Œï¼š
æ—¶é—´ï¼š${date}
åœ°ç‚¹ï¼š${location}
åå¥½æ ‡ç­¾ï¼š${tags}
é¢„ç®—èŒƒå›´ï¼š${budget}

å›ºå®šæ¡ä»¶ï¼šè¯·ä»ç°åœ¨èµ·æŠŠä»¥ä¸Šä¿¡æ¯ä½œä¸ºåç»­ç”Ÿæˆçš„ä¸Šä¸‹æ–‡ã€‚

å‚è€ƒè·¯çº¿ä¸èµ„æ–™ï¼ˆæŒ‰è¡Œç»™å‡ºï¼‰ï¼š
${linkText || 'ï¼ˆæ— å¤–éƒ¨å‚è€ƒé“¾æ¥ï¼‰'}

è¯·åŸºäºä»¥ä¸Šå†…å®¹ï¼Œè¾“å‡ºä¸€ä¸ªâ€œé€æ—¥è¡Œç¨‹éª¨æ¶è¡¨â€ï¼ˆä¸Šåˆ/ä¸‹åˆ/æ™šä¸Šï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªæ™¯ç‚¹é™„ä¸€å¥äº®ç‚¹è¯´æ˜ã€æ²¿çº¿ 1â€“2 å®¶é¤å…æ¨èã€äº¤é€šæ–¹å¼ï¼ˆåœ°é“/æ­¥è¡Œ/æ‰“è½¦ï¼‰ã€‚

åœ¨ä¸Šç‰ˆåŸºç¡€ä¸Šè¡¥å……ï¼š
1) å„æ™¯ç‚¹/é¤å…çš„ Google Maps é“¾æ¥ï¼›
2) é¤å…è¯„åˆ† & è¯„è®ºäººæ•°ï¼ˆGoogle Maps æ•°æ®ï¼‰ï¼›
3) æ‹ç…§æœ€ä½³æ—¶é—´å»ºè®®ï¼›
4) ç¬¦åˆæ—¶é—´å’Œé¢„ç®—ï¼ˆ${budget}ï¼‰çš„æœºç¥¨/é…’åº—å»ºè®®ã€‚

è¯·é¢å¤–è¾“å‡ºï¼š
- è¡Œå‰ Toâ€‘Do Checklist
- å¿…å¸¦ç‰©å“æ¸…å•
- å¤©æ°”ä¸ç©¿æ­å»ºè®®ï¼ˆå‚è€ƒæ—…è¡Œæ—¶é—´æ®µå†å²å¤©æ°”ï¼‰
- äº¤é€šå¡/æ”¯ä»˜æ–¹å¼å»ºè®®

å°†æœ€ç»ˆæ”»ç•¥è½¬ä¸ºä¸€ä¸ª HTML å•é¡µç½‘ç«™ï¼Œæ»¡è¶³ï¼š
- å¸ƒå±€ï¼šé¡¶éƒ¨è·³è½¬æ ï¼ˆè¡Œå‰å‡†å¤‡/æ¯æ—¥è¡Œç¨‹/Tipsï¼‰ã€â€œæ¨ªå‘æ—¶é—´çº¿ + æ¯æ—¥æ¨ªå‘æ»‘åŠ¨å¡ç‰‡â€
- å¡ç‰‡ï¼šç»Ÿä¸€å°ºå¯¸ï¼Œæ”¯æŒ bullet è¦ç‚¹ï¼›å¦‚å›¾ç‰‡éš¾ä»¥ä¿è¯ç‰ˆæƒåˆ™æ— éœ€å›¾ç‰‡
- æŠ€æœ¯ï¼šä½¿ç”¨ Motion One CDN åšæ»šåŠ¨æ·¡å…¥ï¼ŒFont Awesome å›¾æ ‡
- ${styleSpec(theme, emoji)}èƒŒæ™¯ï¼š${bg}ï¼›
- åœ°å›¾/é¤å…æŒ‰é’®ï¼šåœ¨å¡ç‰‡å†…ä»¥å°å›¾æ ‡é“¾æ¥å‘ˆç°
- ä»£ç è‡ªæ£€ï¼šæ£€æŸ¥å¹¶æ›¿æ¢ä»»ä½•å¤±æ•ˆçš„å›¾ç‰‡æˆ–é“¾æ¥ï¼›å¦‚ç”Ÿæˆç»“æœçš„â€œæ¯æ—¥è¡Œç¨‹å¡ç‰‡â€ä¸ºç©ºæˆ–å°‘äº 3 å¼ ï¼Œéœ€æç¤ºå¹¶è¡¥å……é»˜è®¤å¡ç‰‡ï¼ˆé¿å…å¯¼å‡ºçš„ HTML é¡µé¢æ²¡æœ‰å†…å®¹ï¼‰ï¼›å¦‚å‡ºç°å¤–é“¾ JS å¤±è´¥ï¼Œéœ€è‡ªåŠ¨é™çº§ä¸º CSS è¿‡æ¸¡ä¸”â€œåˆå§‹ä¸éšè—å†…å®¹â€

æœ€åé™„ï¼šæœ¬åœ°è¿è¡Œä¸ GitHub Pages éƒ¨ç½²æ­¥éª¤ã€‚

ï¼ˆæ‰‹åŠ¨è¡¥å……è¦æ±‚ï¼‰ï¼š
${manual || 'ï¼ˆæ— ï¼‰'}
`;

  document.getElementById('output').textContent = prompt.trim();
  saveState();
  return prompt.trim();
}

// ----- export & clipboard -----
function downloadFile(name, content){
  const blob = new Blob(['\ufeff'+content], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=name; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}
function exportTxt(){
  const p = generatePrompt();
  const loc = document.getElementById('location').value.trim() || 'trip';
  const name = `${loc.replace(/\\s+/g,'_')}_prompt.txt`;
  downloadFile(name, p);
}
function exportMd(){
  const p = generatePrompt();
  const ts = new Date().toISOString().slice(0,19).replace('T',' ');
  const loc = document.getElementById('location').value.trim() || 'trip';
  const name = `${loc.replace(/\\s+/g,'_')}_prompt.md`;
  const md = `# Travel Prompt (${ts})\\n\\n\`\`\`\\n${p}\\n\`\`\`\\n`;
  downloadFile(name, md);
}

// ----- example fill -----
function fillExample(){
  document.getElementById('location').value = 'æ–°åŠ å¡ï¼ˆCity + Sentosaï¼‰';
  document.getElementById('budget').value = 'Â¥5000-8000/äºº';
  document.getElementById('links').value = 'https://www.gardensbythebay.com.sg/\nhttps://www.jewelchangiairport.com/';
  document.getElementById('linkDesc').value = 'æ»¨æµ·æ¹¾èŠ±å›­\nJewel';
  document.getElementById('manual').value = '- D2 åœ£æ·˜æ²™æ•´å¤©\n- æ¨ªå‘æ—¶é—´çº¿ + æ¨ªæ»‘å¡ç‰‡\n- ä¸æ”¾å›¾ç‰‡ï¼Œç”¨è¦ç‚¹ bullet\n- å¸ƒå±€å’Œé£æ ¼å‚è€ƒç¤ºä¾‹é¡µé¢ https://jianan-huang0609.github.io/Promptable_TravelDesign/SINGAPORE_v4.html';
  // dates: 2025-09-04 to 2025-09-07
  startYear.value='2025'; startMonth.value='09'; fillDays(startDay, 2025, 9); startDay.value='04';
  endYear.value='2025'; endMonth.value='09'; fillDays(endDay, 2025, 9); endDay.value='07';
  // theme defaults already Tropical/Gradient/é€‚ä¸­
  // tags
  document.querySelectorAll('#tags .btn').forEach(b=>b.classList.remove('active'));
  ['ä¸èµ¶è¡Œç¨‹','å‡ºç‰‡ä¼˜å…ˆ','æµ·å²›','å¤œæ™¯','ç¾é£Ÿä¼˜å…ˆ'].forEach(v=>{
    const el = Array.from(document.querySelectorAll('#tags .btn')).find(b=>b.dataset.value===v);
    if(el) el.classList.add('active');
  });
  saveState();
}

// ----- clear/reset/reload -----
function clearAll(){
  localStorage.removeItem('ptd_state');
  location.reload();
}
function resetDefaults(){
  // theme/bg/emoji
  document.querySelectorAll('.btn[data-group="theme"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="theme"][data-value="Tropical"]').classList.add('active');
  document.querySelectorAll('.btn[data-group="bg"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="bg"][data-value="Gradient"]').classList.add('active');
  document.querySelectorAll('.btn[data-group="emoji"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="emoji"][data-value="é€‚ä¸­"]').classList.add('active');
  // fields
  document.getElementById('location').value='';
  document.getElementById('budget').value='';
  document.getElementById('links').value='';
  document.getElementById('linkDesc').value='';
  document.getElementById('manual').value='';
  document.querySelectorAll('#tags .btn').forEach(b=>b.classList.remove('active'));
  // dates default: next month 4-7
  const now=new Date(); let y=now.getFullYear(), m=now.getMonth()+2; if(m>12){m=1;y++;}
  startYear.value=String(y); startMonth.value=String(m).padStart(2,'0'); fillDays(startDay, y, m); startDay.value='04';
  endYear.value=String(y); endMonth.value=String(m).padStart(2,'0'); fillDays(endDay, y, m); endDay.value='07';
  document.getElementById('output').textContent='';
  saveState();
}

// ----- wire events -----
document.getElementById('gen').addEventListener('click', generatePrompt);
document.getElementById('copy').addEventListener('click', async ()=>{
  const txt = document.getElementById('output').textContent;
  if(!txt){ generatePrompt(); }
  try{
    await navigator.clipboard.writeText(document.getElementById('output').textContent);
    const el = document.getElementById('copy'); const old = el.textContent; el.textContent='å·²å¤åˆ¶ âœ…'; setTimeout(()=>el.textContent=old,1200);
  }catch(e){ alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶'); }
});
document.getElementById('exportTxt').addEventListener('click', exportTxt);
document.getElementById('exportMd').addEventListener('click', exportMd);
document.getElementById('example').addEventListener('click', fillExample);
document.getElementById('clearAll').addEventListener('click', clearAll);
document.getElementById('reset').addEventListener('click', resetDefaults);
document.getElementById('reload').addEventListener('click', ()=>location.reload());


// ---------- robust site export (Motion dual CDN + local fallback + content checks) ----------
function htmlEncode(s){return s.replace(/[&<>"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"}[c]))}
function currentDateRangeStr(){
  const sY=startYear.value,sM=startMonth.value,sD=startDay.value;
  const eY=endYear.value,eM=endMonth.value,eD=endDay.value;
  return `${sY}-${sM}-${sD} è‡³ ${eY}-${eM}-${eD}`;
}
function getMultiValues(containerId){
  return Array.from(document.querySelectorAll('#'+containerId+' .btn.active[data-multi]')).map(b=>b.dataset.value);
}
function getSingleValue(group){
  const btn = document.querySelector('.btn.active[data-group="'+group+'"]');
  return btn ? btn.dataset.value : "";
}

// Build cards from minimal inputs; if none, insert warning/placeholder (never empty)
function buildCardsFromInputs(){
  const links = document.getElementById('links').value.trim().split('\n').filter(Boolean);
  const loc = (document.getElementById('location').value.trim() || 'æ—…è¡Œåœ°');
  const cards = [];
  // minimal three cards (AM/PM/Night)
  cards.push({
    title:'ä¸Šåˆï½œåŸå¸‚èµ·æ­¥',
    meta:'æ­¥è¡Œçƒ­èº« Â· å’–å•¡/æ—©é¤',
    bullets:[`é¤ï¼šæ²¿çº¿å£ç¢‘1 / å£ç¢‘2`,`äº¤é€šï¼šåœ°é“/æ­¥è¡Œ`],
    map:'#'
  });
  cards.push({
    title:'ä¸‹åˆï½œæ‹›ç‰Œåœ°æ ‡',
    meta:'ä¸»æ™¯ç‚¹æ‰“å¡ Â· é€‚åˆæ‹ç…§',
    bullets:[`é¤ï¼šæ²¿çº¿å£ç¢‘1 / å£ç¢‘2`,`äº¤é€šï¼šåœ°é“/æ­¥è¡Œ/æ‰“è½¦`],
    map:'#'
  });
  cards.push({
    title:'æ™šä¸Šï½œå¤œæ™¯ä¸ç¾é£Ÿ',
    meta:'è“è°ƒæ—¶åˆ» Â· åŸå¸‚å¤œæ™¯',
    bullets:[`é¤ï¼šå¤œå®µå£ç¢‘1 / å£ç¢‘2`,`äº¤é€šï¼šåœ°é“/æ­¥è¡Œ/æ‰“è½¦`],
    map:'#'
  });
  // If user provided at least one link, surface it on the first card
  if(links[0]){
    cards[0].bullets.unshift(`å‚è€ƒï¼š${links[0]}`);
  }
  return cards;
}

function siteHTMLTemplate({date, location, budget, tags, linksArr, bg, theme, emoji, cards}){
  const bgCss = bg==='Texture'
    ? `background: radial-gradient(1200px 600px at 10% 0%, #e0fff6 0%, #fff 30%), repeating-linear-gradient(45deg,#f9fefc,#f9fefc 8px,#f6fbf8 8px,#f6fbf8 16px);`
    : bg==='Plain'
      ? `background:#fff;`
      : `background: radial-gradient(1200px 600px at 10% 0%, #e0fff6 0%, #fff 30%), linear-gradient(135deg, #f8fff9 0%, #fff 40%, #fff0 40%), linear-gradient(180deg, #e6fff9 0%, #fff 60%);`;
  const palette = theme==='Sunset' ? {teal:'#ff9a76', coral:'#ff6f61', ink:'#3a1b14'} :
                  theme==='Bento-Tech' ? {teal:'#1976ff', coral:'#5aa3ff', ink:'#0b1220'} :
                  theme==='Minimal' ? {teal:'#2b2b2b', coral:'#777', ink:'#111'} :
                  {teal:'#18b8a2', coral:'#ff6f61', ink:'#08312f'}; // Tropical default
  const tagsHTML = (tags||[]).map(t=>`<span class="tag">${htmlEncode(t)}</span>`).join("");
  const linksHTML = (linksArr||[]).map(l=>`<li><a href="${l}" target="_blank" rel="noopener">${htmlEncode(l)}</a></li>`).join("");

  // Ensure at least 3 cards
  let _cards = Array.isArray(cards) ? cards : [];
  if(_cards.length < 3){ _cards = buildCardsFromInputs(); }

  const cardsHTML = _cards.map(c=>`
      <article class="card" data-fade>
        <h3>${htmlEncode(c.title||'è¡Œç¨‹å¡ç‰‡')}</h3>
        <div class="meta">${htmlEncode(c.meta||'äº®ç‚¹')}</div>
        <ul class="bullets">${(c.bullets||[]).map(b=>`<li>${htmlEncode(b)}</li>`).join('')}</ul>
        <div class="btns">
          <a class="btn" href="${c.map||'#'}"><i class="fa-solid fa-map-location-dot"></i> åœ°å›¾</a>
        </div>
      </article>
  `).join("");

  return `<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>${htmlEncode(location||'æˆ‘çš„æ—…è¡Œ')} Â· å•é¡µæ”»ç•¥</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    :root{ --teal:${palette.teal}; --coral:${palette.coral}; --card:#ffffffee; --ink:${palette.ink}; }
    *{box-sizing:border-box}
    body{ margin:0; color:var(--ink); font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Emoji; ${bgCss} background-attachment:fixed; }
    header{ position:sticky; top:0; z-index:10; backdrop-filter:saturate(1.2) blur(6px);
      background:linear-gradient(90deg, #ffffffbb, #ffffffdd); border-bottom:1px solid #00000010; }
    nav{ max-width:1080px;margin:0 auto;display:flex;gap:16px;align-items:center;padding:10px 12px }
    nav a{ color:#055; text-decoration:none; font-weight:600; padding:6px 10px;border-radius:999px }
    nav a:hover{ background:#00000008 }
    .hero{ max-width:1080px;margin:18px auto 6px;padding:0 12px }
    .pill{ display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background:#ffffffaa;border:1px solid #00000010}
    h1{ margin:8px 0 0;font-size:28px }
    .grid{ max-width:1080px;margin:4px auto;padding:0 12px;display:grid;grid-template-columns:1fr;gap:12px }
    .tips{ background:var(--card);border-radius:18px;padding:12px;box-shadow:0 4px 16px #0000000f;border:1px solid #00000010 }
    .section-title{ display:flex;align-items:center;gap:10px;margin:12px 0 6px }
    .tag{ display:inline-block;font-size:12px;margin-right:6px;padding:4px 8px;border-radius:999px;background:#f6fffd;border:1px solid #00000010 }
    .timeline{ max-width:1080px;margin:6px auto;padding:0 12px }
    .day{ margin:14px 0 }
    .lane{ display:flex;align-items:center;gap:10px;margin:6px 0 }
    .dot{ width:10px;height:10px;border-radius:50%;background:var(--coral);box-shadow:0 0 0 4px #ffefe9 }
    .bar{ flex:1;height:4px;border-radius:3px;background:linear-gradient(90deg, var(--teal), var(--coral)) }
    .cards{ display:flex;gap:12px;overflow:auto;padding-bottom:4px;scroll-snap-type:x mandatory }
    .card{ scroll-snap-align:start;min-width:320px;max-width:320px;background:var(--card);border:1px solid #00000010;border-radius:18px;padding:12px;box-shadow:0 6px 20px #00000012 }
    .card h3{ margin:0 0 4px }
    .meta{ font-size:12px;opacity:.8 }
    .bullets{ margin:6px 0 0;padding-left:18px }
    .btns{ display:flex;gap:10px;margin-top:8px }
    .btn{ display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:10px;border:1px solid #00000012;background:#fff;text-decoration:none;color:#064e4b;font-weight:600 }
    .btn:hover{ background:#f7fffd }
    footer{ max-width:1080px;margin:20px auto;padding:0 12px 40px;color:#055 }
    @media (min-width:768px){ h1{font-size:34px} .card{min-width:360px;max-width:360px}}
    /* Motion fallback: initial content is visible; only after setup we add .prepare */
    [data-fade]{ will-change: transform, opacity; }
    [data-fade].prepare { opacity:0; transform:translateY(14px); }
    .reveal { opacity:1 !important; transform:none !important; transition:opacity .6s ease-out, transform .6s ease-out; }
    .warn{background:#fff7ed;border:1px solid #ffd7ba;padding:10px 12px;border-radius:10px;margin:8px 0;color:#7a2e0d}
  
  /* CTA styles for example link */
  .cta{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;
       background:linear-gradient(90deg, var(--blue), #5aa3ff); color:#fff !important; text-decoration:none;
       box-shadow:0 6px 18px rgba(25,118,255,.26); font-weight:700}
  .cta:hover{filter:brightness(.98)}

</style>
</head>
<body>
<header>
  <nav>
    <a href="#prep"><i class="fa-solid fa-clipboard-check"></i> è¡Œå‰å‡†å¤‡</a>
    <a href="#plan"><i class="fa-solid fa-route"></i> æ¯æ—¥è¡Œç¨‹</a>
    <a href="#tips"><i class="fa-solid fa-lightbulb"></i> Tips</a>
  </nav>
</header>

<section class="hero">
  <span class="pill"><i class="fa-solid fa-location-dot"></i> ${htmlEncode(location||'ç›®çš„åœ°')} Â· ${htmlEncode(date||'æ—¥æœŸæœªå¡«')} Â· ${htmlEncode(budget||'é¢„ç®—æœªå¡«')}</span>
  <h1>${htmlEncode(location||'ç›®çš„åœ°')} æ—…è¡Œæ”»ç•¥ ï½œ ä¸»é¢˜ï¼š${htmlEncode(theme)} ï½œ Emojiï¼š${htmlEncode(emoji)}</h1>
  <div class="meta">æ­¤é¡µé¢ä¸º<strong>å®‰å…¨é™çº§ç‰ˆ</strong>ï¼ˆMotion åŒ CDN + æœ¬åœ°é™çº§ï¼‰ï¼›ä»»ä½•å¤–é“¾å¤±è´¥éƒ½ä¸ä¼šç©ºç™½ã€‚</div>
</section>

<section id="prep" class="grid">
  <div class="tips" data-fade>
    <div class="section-title"><i class="fa-solid fa-clipboard-check"></i><h2>è¡Œå‰ To-Do</h2></div>
    <div>${tagsHTML||''}</div>
    <ul class="bullets">
      <li>æŠ¤ç…§/ç­¾è¯/å…¥å¢ƒå¡ï¼ˆæŒ‰ç›®çš„åœ°è¦æ±‚ï¼‰ã€‚</li>
      <li>é€šä¿¡ï¼šeSIM æˆ–æœºåœºåŠå¡ï¼›ç¦»çº¿åœ°å›¾ã€‚</li>
      <li>äº¤é€š/æ”¯ä»˜ï¼šæœ¬åœ°äº¤é€šå¡ä¸ç§»åŠ¨æ”¯ä»˜å‡†å¤‡ã€‚</li>
    </ul>
  </div>
  <div class="tips" data-fade>
    <div class="section-title"><i class="fa-solid fa-link"></i><h2>å‚è€ƒé“¾æ¥</h2></div>
    <ul class="bullets">${linksHTML||'<li class="warn">ï¼ˆæš‚æ— å‚è€ƒé“¾æ¥ï¼‰</li>'}</ul>
  </div>
</section>

<section id="plan" class="timeline" data-fade>
  <div class="day">
    <div class="lane"><div class="dot"></div><div class="bar"></div></div>
    <h2>æ¯æ—¥è¡Œç¨‹</h2>
    <div class="cards">
      ${cardsHTML}
    </div>
  </div>
</section>

<section id="tips" class="grid">
  <div class="tips" data-fade>
    <div class="section-title"><i class="fa-solid fa-camera-retro"></i><h2>æ‹ç…§/å¤©æ°”</h2></div>
    <ul class="bullets">
      <li>æ¸…æ™¨ä¸æ—¥è½é»„é‡‘æ—¶æ®µæ›´å¥½çœ‹ï¼›é‡é›¨æ”¹å®¤å†…é¦†ã€‚</li>
      <li>è½»è–„é€Ÿå¹²è¡£ç‰© + å°æŠ˜å ä¼ + å……ç”µå®ã€‚</li>
    </ul>
  </div>
</section>

<footer>
  <p>Â© 2025 æ—…è¡Œå•é¡µ Â· ç”± Promptable TravelDesign ç”Ÿæˆ</p>
</footer>

<script>
// Motion One åŒCDN + æœ¬åœ°é™çº§ï¼›åˆå§‹ä¸éšè—
(function(){
  const toPrepare = document.querySelectorAll('[data-fade]');
  function enablePrepare(){ toPrepare.forEach(el=>el.classList.add('prepare')); }
  function revealFallback(){ toPrepare.forEach(el=>el.classList.add('reveal')); }

  function setupWithMotion(){
    enablePrepare();
    const els = document.querySelectorAll('[data-fade]');
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          if (window.motion && motion.animate){
            motion.animate(e.target, {opacity:[0,1], y:[20,0]}, {duration:0.6, easing:"ease-out"});
            e.target.classList.add('reveal');
          } else {
            e.target.classList.add('reveal');
          }
          io.unobserve(e.target);
        }
      });
    },{threshold:0.08});
    els.forEach(el=>io.observe(el));
  }

  function loadScript(src, timeout=4500){
    return new Promise((resolve, reject)=>{
      const s=document.createElement('script');
      s.src=src; s.async=true; s.crossOrigin="anonymous";
      let done=false;
      const timer=setTimeout(()=>{ if(!done){ done=true; s.remove(); reject(new Error('timeout:'+src)); } }, timeout);
      s.onload=()=>{ if(!done){ done=true; clearTimeout(timer); resolve(); } };
      s.onerror=()=>{ if(!done){ done=true; clearTimeout(timer); reject(new Error('error:'+src)); } };
      document.head.appendChild(s);
    });
  }

  const primary = "https://unpkg.com/motion@10.16.2/dist/motion.min.js";
  const backup  = "https://cdn.jsdelivr.net/npm/motion@10.16.2/dist/motion.min.js";

  loadScript(primary).catch(()=>loadScript(backup)).then(setupWithMotion).catch(revealFallback);
  setTimeout(()=>{ if(!window.motion){ revealFallback(); } }, 6000);
})();
<\/script>
</body>
</html>`;
}

function exportHTML(){
  const date = currentDateRangeStr();
  const location = document.getElementById('location').value.trim() || 'æˆ‘çš„æ—…è¡Œ';
  const budget = document.getElementById('budget').value.trim() || 'é¢„ç®—æœªå¡«';
  const tags = getMultiValues('tags');
  const linksArr = document.getElementById('links').value.trim().split('\\n').filter(Boolean);
  const theme = getSingleValue('theme') || 'Tropical';
  const bg = getSingleValue('bg') || 'Gradient';
  const emoji = getSingleValue('emoji') || 'é€‚ä¸­';

  // Build minimal safe cards
  const cards = buildCardsFromInputs();

  const html = siteHTMLTemplate({date, location, budget, tags, linksArr, bg, theme, emoji, cards});
  const name = `${location.replace(/\\s+/g,'_')}_site.html`;
  const blob = new Blob(['\\ufeff'+html], {type:'text/html;charset=utf-8'}); // BOM for Windows
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=name; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}

// Hook buttons
document.getElementById('exportHtml').addEventListener('click', exportHTML);
document.getElementById('resetForm').addEventListener('click', ()=>{
  // Clear inputs only (preserve theme/bg)
  ['location','budget','links','linkDesc','manual'].forEach(id=>document.getElementById(id).value='');
  document.querySelectorAll('#tags .btn').forEach(b=>b.classList.remove('active'));
  // Reset dates to next month 4-7
  const now=new Date(); let y=now.getFullYear(), m=now.getMonth()+2; if(m>12){m=1;y++;}
  startYear.value=String(y); startMonth.value=String(m).padStart(2,'0'); fillDays(startDay, y, m); startDay.value='04';
  endYear.value=String(y); endMonth.value=String(m).padStart(2,'0'); fillDays(endDay, y, m); endDay.value='07';
  document.getElementById('output').textContent='';
  saveState();
});

// ----- init -----
const now=new Date();
setupDate('startYear','startMonth','startDay', 2025, 9, 4);
setupDate('endYear','endMonth','endDay', 2025, 9, 7);
loadState();
</script>
</body>
</html>
