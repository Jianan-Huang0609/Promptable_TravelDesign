<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Promptable TravelDesign · Prompt 生成器</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --ink:#0b1220; --muted:#5a6a84; --line:#dde5f1; --card:#fff;
    --blue:#1976ff; --green:#0fb9b1; --coral:#ff7f6a;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:#f8faff;color:var(--ink);
    font-family:"Noto Sans SC","Inter",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Arial}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  h1{margin:8px 0 6px;font-size:28px;color:#0b1220;letter-spacing:.2px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:10px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
  .panel{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 8px 24px rgba(25,118,255,.06)}
  label{display:block;margin-top:10px;font-weight:700}
  input,textarea,select{
    width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;
    margin-top:8px;font-size:14px;background:#fff
  }
  textarea{min-height:84px;resize:vertical}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .btn{border:1px solid var(--line);background:#fff;color:#2b3d55;
    padding:8px 12px;border-radius:999px;font-size:14px;cursor:pointer;user-select:none}
  .btn:hover{border-color:#c8d6ea}
  .btn.active{border-color:transparent;background:linear-gradient(90deg, var(--green), #67dfd9);color:#003c39;box-shadow:0 6px 18px rgba(15,185,177,.28)}
  .btn.blue.active{background:linear-gradient(90deg, var(--blue), #5aa3ff);color:#fff}
  .btn.coral.active{background:linear-gradient(90deg, var(--coral), #ffb19f);color:#5b1a0f}
  .grid{display:grid;gap:14px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  @media (max-width:900px){.grid.cols-2{grid-template-columns:1fr}}
  .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .primary{background:linear-gradient(90deg, var(--blue), #5aa3ff);color:#fff;border:none}
  .primary:hover{filter:brightness(.98)}
  .ghost{background:#fff;border:1px dashed var(--line)}
  .warn{background:#fff6f5;border:1px solid #ffd5cf}
  #output{white-space:pre-wrap;background:#0b1220;color:#e6eefc;padding:14px;border-radius:10px;
    margin-top:12px;border:1px solid #1d2a3f;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
  .hint{font-size:12px;color:var(--muted)}
  .section-title{font-weight:800;margin:0 0 8px 0}
  .divider{height:1px;background:linear-gradient(90deg,rgba(25,118,255,.0),rgba(25,118,255,.2),rgba(25,118,255,.0));margin:12px 0}
  .link{color:#1976ff;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Promptable TravelDesign · Prompt 生成器</h1>
  <div class="sub">按钮化选择 + 手打补充 → 一键导出 Prompt（TXT/MD）。
    <a class="link" href="./examples/singapore-4d3n.html" target="_blank">查看新加坡 4D3N 示例 ↗</a>
  </div>

  <div class="toolbar">
    <button class="btn ghost" id="example">一键示例：新加坡 4D3N</button>
    <button class="btn warn" id="clearAll">清空所有 + 清除缓存</button>
    <button class="btn" id="reset">重置为默认</button>
    <button class="btn" id="reload">页面重载</button>
  </div>

  <div class="panel">
    <div class="section-title">基本信息</div>
    <div class="grid cols-2">
      <div>
        <label>旅行开始日期</label>
        <div class="row">
          <select id="startYear"></select>
          <select id="startMonth"></select>
          <select id="startDay"></select>
        </div>
      </div>
      <div>
        <label>旅行结束日期</label>
        <div class="row">
          <select id="endYear"></select>
          <select id="endMonth"></select>
          <select id="endDay"></select>
        </div>
      </div>
      <div>
        <label>目的地</label>
        <input id="location" placeholder="例如：新加坡 + 附近海岛（民丹/巴淡）">
      </div>
      <div>
        <label>预算范围</label>
        <input id="budget" placeholder="例如：¥5000-8000/人">
      </div>
      <div>
        <label>外部参考链接（每行一个）</label>
        <textarea id="links" placeholder="https://..."></textarea>
      </div>
      <div>
        <label>参考链接简述（可选，对应顺序）</label>
        <textarea id="linkDesc" placeholder="美食打卡\n圣淘沙亲子\n城市拍照点"></textarea>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-title">偏好标签（点按钮可多选）</div>
    <div id="tags" class="row">
      <button class="btn" data-multi data-value="美食优先">美食优先</button>
      <button class="btn" data-multi data-value="出片优先">出片优先</button>
      <button class="btn" data-multi data-value="不赶行程">不赶行程</button>
      <button class="btn" data-multi data-value="海岛">海岛</button>
      <button class="btn" data-multi data-value="夜景">夜景</button>
      <button class="btn" data-multi data-value="购物">购物</button>
      <button class="btn" data-multi data-value="亲子">亲子</button>
    </div>

    <label style="margin-top:14px">手打补充要求（会原样插入 Prompt）</label>
    <textarea id="manual" placeholder="- 周六安排圣淘沙整天\n- 每天加 2 家沿线口碑餐厅\n- 行程卡片横向滑动 + 时间线\n- 不用图片，改为要点 bullet"></textarea>
  </div>

  <div class="panel">
    <div class="section-title">风格与外观</div>
    <div class="row">
      <div>
        <div class="hint">网站主题（单选）</div>
        <div id="theme" class="row">
          <button class="btn blue" data-single data-group="theme" data-value="Bento-Tech">Bento-Tech（蓝白）</button>
          <button class="btn active" data-single data-group="theme" data-value="Tropical">Tropical（海岛）</button>
          <button class="btn coral" data-single data-group="theme" data-value="Sunset">Sunset（日落橙）</button>
          <button class="btn" data-single data-group="theme" data-value="Minimal">Minimal（极简）</button>
        </div>
      </div>
      <div>
        <div class="hint">背景风格（单选）</div>
        <div id="bg" class="row">
          <button class="btn active" data-single data-group="bg" data-value="Gradient">渐变背景</button>
          <button class="btn" data-single data-group="bg" data-value="Texture">细腻纹理</button>
          <button class="btn" data-single data-group="bg" data-value="Plain">纯白</button>
        </div>
      </div>
      <div>
        <div class="hint">Emoji 强度</div>
        <div id="emoji" class="row">
          <button class="btn" data-single data-group="emoji" data-value="少量">少量</button>
          <button class="btn active" data-single data-group="emoji" data-value="适中">适中</button>
          <button class="btn" data-single data-group="emoji" data-value="偏多">偏多</button>
        </div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div class="section-title">生成 & 导出</div>
    <div class="actions">
      <button class="btn primary" id="gen">生成 Prompt</button>
      <button class="btn" id="copy">复制</button>
      <button class="btn" id="exportTxt">导出 .txt</button>
      <button class="btn" id="exportMd">导出 .md</button>
      <span class="hint">将生成的 Prompt 粘贴到 ChatGPT / Cursor。内容会自动保存。</span>
    </div>
    <div id="output"></div>
  </div>

  <div class="panel">
    <div class="section-title">示例入口</div>
    <div class="row">
      <a class="link" href="./examples/singapore-4d3n.html" target="_blank">新加坡 4D3N 成品页面 ↗</a>
    </div>
  </div>
</div>

<script>
// ----- date dropdowns -----
const yRange = [2025, 2028];
function fillYears(sel){ for(let y=yRange[0]; y<=yRange[1]; y++){ const o=document.createElement('option'); o.value=o.textContent=y; sel.appendChild(o);} }
function fillMonths(sel){ for(let m=1; m<=12; m++){ const o=document.createElement('option'); o.value=o.textContent=String(m).padStart(2,'0'); sel.appendChild(o);} }
function daysInMonth(y,m){ return new Date(y, m, 0).getDate(); }
function fillDays(sel, y, m){ sel.innerHTML=''; const n=daysInMonth(y, m); for(let d=1; d<=n; d++){ const o=document.createElement('option'); o.value=o.textContent=String(d).padStart(2,'0'); sel.appendChild(o);} }

function setupDate(idY,idM,idD, defY,defM,defD){
  const y=document.getElementById(idY), m=document.getElementById(idM), d=document.getElementById(idD);
  fillYears(y); fillMonths(m);
  y.value=defY; m.value=String(defM).padStart(2,'0'); fillDays(d, defY, defM); d.value=String(defD).padStart(2,'0');
  y.addEventListener('change', ()=>{ fillDays(d, Number(y.value), Number(m.value)); saveState(); });
  m.addEventListener('change', ()=>{ fillDays(d, Number(y.value), Number(m.value)); saveState(); });
  d.addEventListener('change', saveState);
}

// ----- buttons -----
function getMultiValues(containerId){
  return Array.from(document.querySelectorAll('#'+containerId+' .btn.active[data-multi]')).map(b=>b.dataset.value);
}
function getSingleValue(group){
  const btn = document.querySelector('.btn.active[data-group="'+group+'"]');
  return btn ? btn.dataset.value : "";
}
function toggleBtn(e){
  const b = e.target.closest('.btn'); if(!b) return;
  if(b.id==='gen'||b.id==='copy'||b.id==='exportTxt'||b.id==='exportMd'||b.id==='example'||b.id==='clearAll'||b.id==='reset'||b.id==='reload') return;
  if(b.hasAttribute('data-multi')) b.classList.toggle('active');
  if(b.hasAttribute('data-single')){
    const group = b.dataset.group;
    document.querySelectorAll('.btn[data-group="'+group+'"]').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
  }
  saveState();
}
document.addEventListener('click', toggleBtn);

// ----- state -----
function currentDateRangeStr(){
  const sY=startYear.value,sM=startMonth.value,sD=startDay.value;
  const eY=endYear.value,eM=endMonth.value,eD=endDay.value;
  return `${sY}-${sM}-${sD} 至 ${eY}-${eM}-${eD}`;
}
function saveState(){
  const state = {
    startYear:startYear.value, startMonth:startMonth.value, startDay:startDay.value,
    endYear:endYear.value, endMonth:endMonth.value, endDay:endDay.value,
    location: document.getElementById('location').value,
    budget: document.getElementById('budget').value,
    links: document.getElementById('links').value,
    linkDesc: document.getElementById('linkDesc').value,
    manual: document.getElementById('manual').value,
    tags: getMultiValues('tags'),
    theme: getSingleValue('theme'),
    bg: getSingleValue('bg'),
    emoji: getSingleValue('emoji'),
  };
  localStorage.setItem('ptd_state', JSON.stringify(state));
}
function loadState(){
  const raw = localStorage.getItem('ptd_state');
  if(!raw) return;
  try{
    const s = JSON.parse(raw);
    startYear.value = s.startYear || startYear.value;
    startMonth.value = s.startMonth || startMonth.value;
    fillDays(startDay, Number(startYear.value), Number(startMonth.value));
    startDay.value = s.startDay || startDay.value;

    endYear.value = s.endYear || endYear.value;
    endMonth.value = s.endMonth || endMonth.value;
    fillDays(endDay, Number(endYear.value), Number(endMonth.value));
    endDay.value = s.endDay || endDay.value;

    document.getElementById('location').value = s.location||"";
    document.getElementById('budget').value = s.budget||"";
    document.getElementById('links').value = s.links||"";
    document.getElementById('linkDesc').value = s.linkDesc||"";
    document.getElementById('manual').value = s.manual||"";
    (s.tags||[]).forEach(v=>{
      const el = Array.from(document.querySelectorAll('#tags .btn[data-multi]')).find(b=>b.dataset.value===v);
      if(el) el.classList.add('active');
    });
    ['theme','bg','emoji'].forEach(group=>{
      const val = s[group]; if(!val) return;
      const el = Array.from(document.querySelectorAll('.btn[data-group="'+group+'"]')).find(b=>b.dataset.value===val);
      if(el){ document.querySelectorAll('.btn[data-group="'+group+'"]').forEach(x=>x.classList.remove('active')); el.classList.add('active'); }
    });
  }catch(e){console.warn(e)}
}

// ----- prompt -----
function styleSpec(theme, emoji){
  if(theme==='Tropical') return `风格：Tropical 海岛风（海岛青绿+珊瑚橙），细腻纹理或渐变背景；emoji 使用量：${emoji}；`;
  if(theme==='Sunset') return `风格：Sunset 日落橙（暖橙渐变），大号标题，柔和投影；emoji 使用量：${emoji}；`;
  if(theme==='Minimal') return `风格：Minimal 极简（黑白灰 + 少量点缀色），留白多；emoji 使用量：${emoji}；`;
  return `风格：Bento-Tech 蓝白科技感（Bento 卡片 + Motion One 动效）；emoji 使用量：${emoji}；`;
}
function generatePrompt(){
  const date = currentDateRangeStr();
  const location = document.getElementById('location').value.trim();
  const budget = document.getElementById('budget').value.trim();
  const tags = getMultiValues('tags').join(' / ');
  const links = document.getElementById('links').value.trim().split('\n').filter(Boolean);
  const linkDesc = document.getElementById('linkDesc').value.trim().split('\n').filter(Boolean);
  const manual = document.getElementById('manual').value.trim();
  const theme = getSingleValue('theme') || 'Tropical';
  const bg = getSingleValue('bg') || 'Gradient';
  const emoji = getSingleValue('emoji') || '适中';
  const linkText = links.map((l,i)=>`[链接${i+1}] ${linkDesc[i]||''} ${l}`).join('\n');

  const prompt = `我将进行一次旅行：
时间：${date}
地点：${location}
偏好标签：${tags}
预算范围：${budget}

固定条件：请从现在起把以上信息作为后续生成的上下文。

参考路线与资料（按行给出）：
${linkText || '（无外部参考链接）'}

请基于以上内容，输出一个“逐日行程骨架表”（上午/下午/晚上），并为每个景点附一句亮点说明、沿线 1–2 家餐厅推荐、交通方式（地铁/步行/打车）。

在上版基础上补充：
1) 各景点/餐厅的 Google Maps 链接；
2) 餐厅评分 & 评论人数（Google Maps 数据）；
3) 拍照最佳时间建议；
4) 符合时间和预算（${budget}）的机票/酒店建议。

请额外输出：
- 行前 To‑Do Checklist
- 必带物品清单
- 天气与穿搭建议（参考旅行时间段历史天气）
- 交通卡/支付方式建议

将最终攻略转为一个 HTML 单页网站，满足：
- 布局：顶部跳转栏（行前准备/每日行程/Tips）、“横向时间线 + 每日横向滑动卡片”
- 卡片：统一尺寸，支持 bullet 要点；如图片难以保证版权则无需图片
- 技术：使用 Motion One CDN 做滚动淡入，Font Awesome 图标
- ${styleSpec(theme, emoji)}背景：${bg}；
- 地图/餐厅按钮：在卡片内以小图标链接呈现
- 代码自检：检查并替换任何失效的图片或链接

最后附：本地运行与 GitHub Pages 部署步骤。

（手动补充要求）：
${manual || '（无）'}
`;

  document.getElementById('output').textContent = prompt.trim();
  saveState();
  return prompt.trim();
}

// ----- export & clipboard -----
function downloadFile(name, content){
  const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download=name; a.click();
  setTimeout(()=>URL.revokeObjectURL(url), 500);
}
function exportTxt(){
  const p = generatePrompt();
  const loc = document.getElementById('location').value.trim() || 'trip';
  const name = `${loc.replace(/\\s+/g,'_')}_prompt.txt`;
  downloadFile(name, p);
}
function exportMd(){
  const p = generatePrompt();
  const ts = new Date().toISOString().slice(0,19).replace('T',' ');
  const loc = document.getElementById('location').value.trim() || 'trip';
  const name = `${loc.replace(/\\s+/g,'_')}_prompt.md`;
  const md = `# Travel Prompt (${ts})\\n\\n\`\`\`\\n${p}\\n\`\`\`\\n`;
  downloadFile(name, md);
}

// ----- example fill -----
function fillExample(){
  document.getElementById('location').value = '新加坡（City + Sentosa）';
  document.getElementById('budget').value = '¥5000-8000/人';
  document.getElementById('links').value = 'https://www.gardensbythebay.com.sg/\\nhttps://www.jewelchangiairport.com/';
  document.getElementById('linkDesc').value = '滨海湾花园\\nJewel';
  document.getElementById('manual').value = '- D2 圣淘沙整天\\n- 横向时间线 + 横滑卡片\\n- 不放图片，用要点 bullet\\n- 布局和风格参考示例页面 /examples/singapore-4d3n.html';
  // dates: 2025-09-04 to 2025-09-07
  startYear.value='2025'; startMonth.value='09'; fillDays(startDay, 2025, 9); startDay.value='04';
  endYear.value='2025'; endMonth.value='09'; fillDays(endDay, 2025, 9); endDay.value='07';
  // theme defaults already Tropical/Gradient/适中
  // tags
  document.querySelectorAll('#tags .btn').forEach(b=>b.classList.remove('active'));
  ['不赶行程','出片优先','海岛','夜景','美食优先'].forEach(v=>{
    const el = Array.from(document.querySelectorAll('#tags .btn')).find(b=>b.dataset.value===v);
    if(el) el.classList.add('active');
  });
  saveState();
}

// ----- clear/reset/reload -----
function clearAll(){
  localStorage.removeItem('ptd_state');
  location.reload();
}
function resetDefaults(){
  // theme/bg/emoji
  document.querySelectorAll('.btn[data-group="theme"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="theme"][data-value="Tropical"]').classList.add('active');
  document.querySelectorAll('.btn[data-group="bg"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="bg"][data-value="Gradient"]').classList.add('active');
  document.querySelectorAll('.btn[data-group="emoji"]').forEach(x=>x.classList.remove('active'));
  document.querySelector('.btn[data-group="emoji"][data-value="适中"]').classList.add('active');
  // fields
  document.getElementById('location').value='';
  document.getElementById('budget').value='';
  document.getElementById('links').value='';
  document.getElementById('linkDesc').value='';
  document.getElementById('manual').value='';
  document.querySelectorAll('#tags .btn').forEach(b=>b.classList.remove('active'));
  // dates default: next month 4-7
  const now=new Date(); let y=now.getFullYear(), m=now.getMonth()+2; if(m>12){m=1;y++;}
  startYear.value=String(y); startMonth.value=String(m).padStart(2,'0'); fillDays(startDay, y, m); startDay.value='04';
  endYear.value=String(y); endMonth.value=String(m).padStart(2,'0'); fillDays(endDay, y, m); endDay.value='07';
  document.getElementById('output').textContent='';
  saveState();
}

// ----- wire events -----
document.getElementById('gen').addEventListener('click', generatePrompt);
document.getElementById('copy').addEventListener('click', async ()=>{
  const txt = document.getElementById('output').textContent;
  if(!txt){ generatePrompt(); }
  try{
    await navigator.clipboard.writeText(document.getElementById('output').textContent);
    const el = document.getElementById('copy'); const old = el.textContent; el.textContent='已复制 ✅'; setTimeout(()=>el.textContent=old,1200);
  }catch(e){ alert('复制失败，请手动复制'); }
});
document.getElementById('exportTxt').addEventListener('click', exportTxt);
document.getElementById('exportMd').addEventListener('click', exportMd);
document.getElementById('example').addEventListener('click', fillExample);
document.getElementById('clearAll').addEventListener('click', clearAll);
document.getElementById('reset').addEventListener('click', resetDefaults);
document.getElementById('reload').addEventListener('click', ()=>location.reload());

// ----- init -----
const now=new Date();
setupDate('startYear','startMonth','startDay', 2025, 9, 4);
setupDate('endYear','endMonth','endDay', 2025, 9, 7);
loadState();
</script>
</body>
</html>
